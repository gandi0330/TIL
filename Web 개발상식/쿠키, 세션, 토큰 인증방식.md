# 인증 방식의 종류 (Cookie, Session, Token)

---

서버가 클라이언트의 인증을 확인하는 방법은 크게 **쿠키, 세션, 토큰** 방식이 있다.

각각의 특징과 장단점을 알아보자

## Cookie 인증

쿠키는 Key-Value 형식의 데이터이다.

클라이언트의 브라우저에 저장되어 서버와 통신할 때 사용된다

#### 쿠키를 활용한 로그인 인증 방법

1. 클라이언트가 로그인 요청을 한다
2. 서버에서 요청을 받고 로그인 로직을 수행한 뒤 응답으로 유저가 로그인 했음을 알리는 정보를 쿠키에 담아 클라이언트에 제공한다
3. 클라이언트는 요청할 때 쿠키 또한 같이 요청에 넣어서 유저임을 인증받는다

#### 쿠키 인증방식의 단점

- XSS(Cross-Site Scripting) 공격
    
    자바스크립트는 사용자의 컴퓨터에서 실행된다. 이러한 점을 이용해 자바스크립트의 document.cookie라는 명령어로 공격자들이 쿠키 값을 탈취하는 공격이다
    
- 스니핑(Sniffing) 공격
    
    서버와 클라이언트는 통신할 때마다 쿠키를 주고받는다. 서버와 클라이언트의 네트워크 중간에서 패킷 정보를 도청하는 것이 스니핑 공격이고, 때문에 쿠키를 탈취당할 수 있다
    
- 공용 PC에서의 쿠키값
    
    쿠키는 사용자의 하드디스크에 저장된다. 따라서 공용PC의 경우 쿠키를 쉽게 탈취할 수 있다
    

이러한 쿠키의 취약점 때문에 쿠키에는 민감한 정보보다는 브라우저의 설정(사용자가 선호하는 언어, 아이디 저장 체크여부 등)을 저장하거나, 쿠키 값을 암호화 하거나, 브라우저에서 접근할 수 없도록(httpOnly) 설정하곤 한다

## Session / Cookie 인증

쿠키의 취약점 때문에 클라이언트의 민감한 인증 정보를 그냥 쿠키에 저장하는것은 위험하다. 따라서 이를 브라우저가 아닌 서버 측에 저장하고 관리하는 방법이 Session 인증 방법이다.

서버의 메모리나 데이터베이스에 저장한다

#### Session을 활용한 로그인 인증 방법

1. 클라이언트가 로그인 요청을 하고 서버에서는 로그인 로직을 수행한다
2. 서버에서 서버 메모리(또는 데이터베이스)에 세션을 저장하고 세션을 식별하기 위한 세션 id를 쿠키로 클라이언트에 제공한다
3. 클라이언트는 이후 모든 요청에 세션 id를 담은 쿠키를 함께 전송한다
4. 서버는 클라이언트가 보낸 id와 서버 메모리의 세션을 비교하여 인증을 수행한다

세션 인증방식의 단점

- 이미 인증된 사용자의 Cookie를 탈취하여 해당 Cookie로 서버에 요청을 보내면 서버는 사용자인지 공격자인지 구별할 수 없다
- 서버측에서 세션을 저장하기 때문에 서버에 부하가 생길 수 있다
- 서버가 분산되어 있고 한 유저가 로그인을 하면 해당 유저는 분산되어있는 서버 중 처음 로그인했던 서버에 요청을 해야한다(서버마다 세션저장소가 다르기 때문)

세션 인증방식을 사용하면 쿠키가 노출되더라도 쿠키 자체는 유의미한 값을 가지지 않는다. (쿠키 인증방식에 비해 안전) 하지만 해당 쿠키로 공격자가 요청을 한다면 서버는 민감한 정보를 제공할 것이다. 따라서 이를 막기 위해 세션에 유효기간을 설정하여 쿠키가 탈취되더라도 일정 시간이 지나면 해당 쿠키를 사용할 수 없도록 만들 수 있다.

## Token 인증

클라이언트가 서버에 접속하면 서버에서 클라이언트가 인증되었다는 증거로 토큰을 부여한다

이 토큰을 통해 클라이언트는 서버에 요청을 보낼때마다 헤더에 토큰을 담아 보낸다

그리고 서버는 클라이언트로부터 받은 토큰을 서버에서 제공한 토큰과 일치한지의 여부를 체크하여 인증을 처리한다

#### Token을 활용한 로그인 인증방법

1. 클라이언트가 로그인 요청을 하고 서버는 로그인 로직을 수행한다
2. 서버에서 클라이언트에게 유일한 토큰을 발급한다
3. 클라이언트는 토큰을 받아 스토리지에 저장하고 서버에 요청할 때마다 헤더에 포함시켜 전달한다
4. 서버는 토큰을 전달받아 검증하고 응답한다

#### Token 방식의 장점

- 기존의 세션기반 인증처럼 세션 저장소를 가질 필요가 없다
- 토큰이 클라이언트에 저장되기 때문에 세션기반에 비해 서버의 부담이 적어진다
- 로그인 정보를 서버에 저장하지 않기 때문에 서버가 분산되어도 어느 서버에나 로그인 요청을 보낼 수 있다
- 클라이언트가 서버로 요청할 때 더 이상 쿠키를 전달하지 않으므로 쿠키 사용에 의한 취약점이 사라진다

#### Token 방식의 단점

- 토큰의 데이터 길이가 길어 네트워크의 부하가 커질 수 있다
- 토큰을 탈취당하면 대처하기 어렵다

Token 인증방식은 세션 인증방식과 같이 사용자 정보를 세션 저장소에 저장하고 조회하는 과정을 하지 않는다. 서버는 단지 해당 토큰이 유효한지만 확인하기 때문에 세션 인증방식에 비해 효율적이다. 하지만 여전히 탈취의 위험성은 존재한다.
